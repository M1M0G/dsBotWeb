{"version":3,"sources":["components/Music/SongPanel/index.css","components/Music/Queue/index.css","components/Music/MusicConsole/index.css","components/Music/Addons/index.css","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/arrayWithHoles.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/iterableToArrayLimit.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/nonIterableRest.js","utils/index.js","components/Music/SongPanel/Song.js","components/Music/SongPanel/songPanel.js","components/Music/Queue/index.js","components/Music/Addons/index.js","components/Music/MusicConsole/index.js","pages/music.js"],"names":["module","exports","_slicedToArray","arr","i","Array","isArray","Symbol","iterator","Object","_arr","_n","_d","_e","undefined","_s","_i","next","done","push","value","length","err","unsupportedIterableToArray","TypeError","convertTime","sec","hours","Math","floor","minutes","seconds","formatted","toString","padStart","Song","props","React","useState","data","setData","pause","setPause","skipSong","a","fetch","pauseSong","useEffect","durationEvent","EventSource","onmessage","e","setProgress","JSON","parse","onerror","close","song","dur","ceil","playTime","className","styles","audioPlayer","title","audioStream","type","audio","max","timer","controls","onClick","SongPanel","observer","playSong","method","headers","body","stringify","url","state","songUrl","setState","rootStore","this","progress","duration","songPanel","inputUrl","placeholder","onChange","target","songs","songContainer","Component","Queue","queueContainer","queue","map","queueItem","id","empty","Addons","addons","MusicConsole","inject","connect","connectInterval","ws","WebSocket","that","onopen","console","log","timeout","clearTimeout","onclose","min","reason","setTimeout","check","evt","message","checkQueue","error","res","json","addonsContainer","Music"],"mappings":"oFACAA,EAAOC,QAAU,CAAC,UAAY,uBAAuB,cAAgB,2BAA2B,SAAW,sBAAsB,SAAW,sBAAsB,YAAc,yBAAyB,cAAgB,2BAA2B,MAAQ,mBAAmB,MAAQ,mBAAmB,YAAc,2B,mBCAxTD,EAAOC,QAAU,CAAC,MAAQ,mBAAmB,UAAY,uBAAuB,eAAiB,4BAA4B,MAAQ,qB,mBCArID,EAAOC,QAAU,CAAC,gBAAkB,+B,mBCApCD,EAAOC,QAAU,CAAC,OAAS,sB,gKCGZ,SAASC,EAAeC,EAAKC,GAC1C,OCLa,SAAyBD,GACtC,GAAIE,MAAMC,QAAQH,GAAM,OAAOA,EDIxB,CAAeA,IELT,SAA+BA,EAAKC,GACjD,GAAsB,qBAAXG,QAA4BA,OAAOC,YAAYC,OAAON,GAAjE,CACA,IAAIO,EAAO,GACPC,GAAK,EACLC,GAAK,EACLC,OAAKC,EAET,IACE,IAAK,IAAiCC,EAA7BC,EAAKb,EAAII,OAAOC,cAAmBG,GAAMI,EAAKC,EAAGC,QAAQC,QAChER,EAAKS,KAAKJ,EAAGK,QAEThB,GAAKM,EAAKW,SAAWjB,GAH8CO,GAAK,IAK9E,MAAOW,GACPV,GAAK,EACLC,EAAKS,EACL,QACA,IACOX,GAAsB,MAAhBK,EAAW,QAAWA,EAAW,SAC5C,QACA,GAAIJ,EAAI,MAAMC,GAIlB,OAAOH,GFnBuB,CAAqBP,EAAKC,IAAM,OAAAmB,EAAA,GAA2BpB,EAAKC,IGLjF,WACb,MAAM,IAAIoB,UAAU,6IHIgF,GIL/F,IAAMC,EAAc,SAACC,GACxB,IAAIC,EAAQC,KAAKC,MAAMH,EAAI,GAAG,IAC1BI,EAAUF,KAAKC,MAAMH,EAAI,IAAc,GAARC,EAC/BI,EAAUH,KAAKC,MAAMH,EAAI,IAEzBM,EAAY,CACZL,EAAMM,WACNH,EAAQG,WACRF,EAAQE,YAEZ,OAAc,IAAVN,EACM,GAAN,OAAUK,EAAU,GAApB,YAA0BA,EAAU,GAAGE,SAAS,EAAG,MAEjD,GAAN,OAAUF,EAAU,GAAGE,SAAS,EAAG,KAAnC,YAA2CF,EAAU,GAAGE,SAAS,EAAG,KAApE,YAA4EF,EAAU,GAAGE,SAAS,EAAG,O,OCoD1FC,I,QAAAA,EA7Df,SAAcC,GAAQ,IAAD,IACOC,IAAMC,SAAS,MADtB,GACVC,EADU,KACJC,EADI,SAESH,IAAMC,UAAS,GAFxB,GAEVG,EAFU,KAEHC,EAFG,KAGXC,EAAQ,uCAAG,sBAAAC,EAAA,sEACPC,MAAM,aADC,2CAAH,qDAIRC,EAAS,uCAAG,sBAAAF,EAAA,sEACRC,MAAM,cADE,OAEdH,GAAUD,GAFI,2CAAH,qDASfM,qBAAU,WACN,IAAIC,EAAgB,IAAIC,YAAY,iBAIpC,OAHAD,EAAcE,UAAY,SAAAC,GAAC,OAAIC,EAAYC,KAAKC,MAAMH,EAAEZ,QACxDS,EAAcO,QAAU,kBAAMP,EAAcQ,SAErC,kBAAMR,EAAcQ,WAE5B,CAACpB,EAAMqB,OAmBV,IAAML,EAAc,SAACM,GACjBlB,EAAQZ,KAAK+B,MAAMD,EAAIE,SAAS,OAEpC,OACI,sBAAKC,UAAWC,IAAOC,YAAvB,UACI,iHACA,6BAAK3B,EAAMqB,KAAKO,QAChB,sBAAKH,UAAWC,IAAOG,YAAvB,UACI,uBAAOC,KAAM,QAASL,UAAWC,IAAOK,MAAO/C,MAAOmB,EAAM6B,IAAOhC,EAAMqB,KAAKpC,SAC9E,sBAAKwC,UAAWC,IAAOO,MAAvB,UAA+B5C,EAAYc,GAA3C,MAAqDd,EAAYW,EAAMqB,KAAKpC,cAEhF,gCACI,wBAAQwC,UAAWC,IAAOQ,SAAUC,QAAS,WAAOzB,KAApD,gBACA,wBAAQe,UAAWC,IAAOQ,SAAUC,QAAS,WAAO5B,KAApD,sBCND6B,EAxCdC,Y,oDAEG,WAAYrC,GAAQ,IAAD,8BACf,cAAMA,IAKVsC,SANmB,sBAMR,sBAAA9B,EAAA,sEAEDC,MAAM,YAAa,CACrB8B,OAAQ,OACRC,QAAS,CACL,eAAgB,kCAEpBC,KAAMxB,KAAKyB,UAAU,CAACC,IAAK,EAAKC,MAAMC,YAPnC,OASP,EAAKC,SAAS,CAACD,QAAS,KATjB,2CAJP,EAAKD,MAAQ,CACTC,QAAS,IAHE,E,0CAoBnB,WAAU,IAAD,OACEE,EAAaC,KAAKhD,MAAlB+C,UADF,EAEwBC,KAAKJ,MAF7B,EAEEK,SAFF,EAEYC,SACjB,OACI,gCACI,sBAAKzB,UAAWC,IAAOyB,UAAvB,UACI,uBAAO1B,UAAWC,IAAO0B,SAAUC,YAAa,uDAAgBrE,MAAOgE,KAAKJ,MAAMC,QAASS,SAAU,SAACvC,GAAD,OAAM,EAAK+B,SAAS,CAACD,QAAS9B,EAAEwC,OAAOvE,WAC5I,wBAAQyC,UAAWC,IAAOQ,SAAUC,QAASa,KAAKV,SAAlD,kBAEHS,EAAUS,MAAMvE,OAAS,EACtB,qBAAKwC,UAAWC,IAAO+B,cAAvB,SACI,cAAC,EAAD,CAAMpC,KAAQ0B,EAAUS,MAAM,OAC1B,Y,GAjCJE,e,mBCgBTC,EAzBdtB,Y,oDAEG,WAAYrC,GAAQ,uCACVA,G,0CAGV,WAEI,OACI,sBAAKyB,UAAWC,IAAOkC,eAAvB,UACI,4EACA,oBAAInC,UAAWC,IAAOmC,MAAtB,SACKb,KAAKhD,MAAM+C,UAAUS,MAAMvE,OAAS,EAAG+D,KAAKhD,MAAM+C,UAAUS,MAAMM,KAAI,SAAAzC,GAAI,OACvE,qBAAkBI,UAAWC,IAAOqC,UAApC,UACI,4BAAI1C,EAAKO,QACT,+BAAOvC,EAAYgC,EAAKpC,YAFnBoC,EAAK2C,OAId,6BACA,qBAAKvC,UAAWC,IAAOuC,MAAvB,uD,GAjBJP,e,oCCOLQ,E,4JATX,WACI,OACI,qBAAKzC,UAAWC,IAAOyC,a,GAHdT,aCqFNU,EAjFdC,YAAO,Y,GACPhC,Y,oDAEG,WAAYrC,GAAQ,IAAD,8BACf,cAAMA,IAYVsE,QAAU,WACN,IAEIC,EAFEC,EAAK,IAAIC,UAAJ,gCACPC,EAAI,eAERF,EAAGG,OAAS,WACRC,QAAQC,IAAI,uBAEZ,EAAK/B,SAAS,CAAE0B,GAAIA,IAEpBE,EAAKI,QAAU,IACfC,aAAaR,IAGjBC,EAAGQ,QAAU,SAAAjE,GACT6D,QAAQC,IAAR,2DACwDrF,KAAKyF,IACrD,IACCP,EAAKI,QAAUJ,EAAKI,SAAW,KAHxC,YAKI/D,EAAEmE,QAGNR,EAAKI,QAAUJ,EAAKI,QAAUJ,EAAKI,QACnCP,EAAkBY,WAAW,EAAKC,MAAO5F,KAAKyF,IAAI,IAAOP,EAAKI,WAGlEN,EAAG1D,UAAY,SAAAuE,GAEX,IAAMC,EAAUrE,KAAKC,MAAMmE,EAAIlF,MAC5BmF,EAAQzB,OACP,EAAK7D,MAAM+C,UAAUwC,WAAWD,IAIxCd,EAAGrD,QAAU,SAAAjC,GACT0F,QAAQY,MACJ,6BACAtG,EAAIoG,QACJ,kBAGJd,EAAGpD,UAtDQ,EA0DnBmE,WA1DmB,sBA0DN,8BAAA/E,EAAA,sEACSC,MAAM,cADf,cACHgF,EADG,gBAEUA,EAAIC,OAFd,OAEHvF,EAFG,OAGT,EAAKH,MAAM+C,UAAUwC,WAAWpF,GAHvB,2CAxDT,EAAKyC,MAAQ,CACTiB,MAAO,KACPW,GAAI,MAJO,E,qDAQnB,WACIxB,KAAKsB,UACLtB,KAAKuC,e,oBAsDT,WAEI,OACI,gCACI,cAAC,EAAD,CAAWxC,UAAWC,KAAKhD,MAAM+C,YACjC,sBAAKtB,UAAWC,IAAOiE,gBAAvB,UACI,cAAC,EAAD,CAAO5C,UAAaC,KAAKhD,MAAM+C,YAC/B,cAAC,EAAD,c,GAxEOW,e,MCJrBkC,EADLvD,Y,oDAEG,WAAYrC,GAAQ,uCACVA,G,0CAWV,WAEI,OACI,8BACI,cAAC,EAAD,U,GAjBI0D,e,EAwBLkC","file":"build/js/3.e93c9440.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"songPanel\":\"index-songPanel-2q4k\",\"audioDuration\":\"index-audioDuration-2iTl\",\"inputUrl\":\"index-inputUrl-3Orv\",\"controls\":\"index-controls-1f01\",\"audioStream\":\"index-audioStream-1RQJ\",\"songContainer\":\"index-songContainer-3DS7\",\"audio\":\"index-audio-263z\",\"timer\":\"index-timer-3Hn6\",\"audioPlayer\":\"index-audioPlayer-2_0P\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"queue\":\"index-queue-3Hup\",\"queueItem\":\"index-queueItem-3sbN\",\"queueContainer\":\"index-queueContainer-15h3\",\"empty\":\"index-empty-3G84\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"addonsContainer\":\"index-addonsContainer-IwvF\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"addons\":\"index-addons-3s9_\"};","import arrayWithHoles from \"@babel/runtime/helpers/esm/arrayWithHoles\";\nimport iterableToArrayLimit from \"@babel/runtime/helpers/esm/iterableToArrayLimit\";\nimport unsupportedIterableToArray from \"@babel/runtime/helpers/esm/unsupportedIterableToArray\";\nimport nonIterableRest from \"@babel/runtime/helpers/esm/nonIterableRest\";\nexport default function _slicedToArray(arr, i) {\n  return arrayWithHoles(arr) || iterableToArrayLimit(arr, i) || unsupportedIterableToArray(arr, i) || nonIterableRest();\n}","export default function _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}","export default function _iterableToArrayLimit(arr, i) {\n  if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}","export default function _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}","export const convertTime = (sec) => {\r\n    let hours = Math.floor(sec/60/60);\r\n    let minutes = Math.floor(sec/60) - hours * 60;\r\n    let seconds = Math.floor(sec%60);\r\n\r\n    let formatted = [\r\n        hours.toString(),\r\n        minutes.toString(),\r\n        seconds.toString()\r\n    ];\r\n    if (hours === 0) {\r\n        return `${formatted[1]}:${formatted[2].padStart(2, \"0\")}`\r\n    }\r\n    return `${formatted[0].padStart(2, \"0\")}:${formatted[1].padStart(2, \"0\")}:${formatted[2].padStart(2, \"0\")}`\r\n}","import React, {useEffect} from 'react';\r\nimport {convertTime} from \"../../../utils\";\r\nimport styles from \"./index.css\";\r\n\r\nfunction Song(props) {\r\n    const [data, setData] = React.useState(null)\r\n    const [pause, setPause] = React.useState(false)\r\n    const skipSong = async () => {\r\n        await fetch('/api/skip')\r\n    }\r\n\r\n    const pauseSong = async () => {\r\n        await fetch('/api/pause')\r\n        setPause(!pause)\r\n    }\r\n\r\n    const stopSong = async () => {\r\n        await fetch('/api/stop')\r\n    }\r\n\r\n    useEffect(() => {\r\n        let durationEvent = new EventSource('/api/duration')\r\n        durationEvent.onmessage = e => setProgress(JSON.parse(e.data))\r\n        durationEvent.onerror = () => durationEvent.close()\r\n\r\n        return () => durationEvent.close()\r\n\r\n    }, [props.song])\r\n\r\n\r\n    // useEffect(() => {\r\n    //     let counter = 0;\r\n    //     let timer = setInterval(() => {\r\n    //         console.log(pause)\r\n    //             if(!pause) {\r\n    //                 if (counter !== props.song.length){\r\n    //                     setData(counter)\r\n    //                     counter++\r\n    //                 } else {\r\n    //                     setData(counter)\r\n    //                     clearInterval(timer)\r\n    //                 }\r\n    //             }\r\n    //         }, 1000)\r\n    // }, [props.song])\r\n\r\n    const setProgress = (dur) => {\r\n        setData(Math.ceil(+dur.playTime/1000))\r\n    }\r\n    return (\r\n        <div className={styles.audioPlayer}>\r\n            <legend>Текущая песня: </legend>\r\n            <h3>{props.song.title}</h3>\r\n            <div className={styles.audioStream}>\r\n                <input type={\"range\"} className={styles.audio} value={data} max = {props.song.length}/>\r\n                <div className={styles.timer}>{convertTime(data)} | {convertTime(props.song.length)}</div>\r\n            </div>\r\n            <div>\r\n                <button className={styles.controls} onClick={() => {pauseSong()}}>||</button>\r\n                <button className={styles.controls} onClick={() => {skipSong()}}>></button>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default Song;","import React, {Component} from 'react';\r\nimport styles from \"./index.css\";\r\nimport {observer} from \"mobx-react\";\r\nimport Song from \"./Song\";\r\nimport {convertTime} from \"../../../utils\";\r\n// componentDidMount() {\r\n//     const eventSource = new EventSource(\"http://localhost:4000/music\")\r\n//     const dataElem = document.getElementById(\"data\")\r\n//     eventSource.onmessage = (msg) => {\r\n//         dataElem.innerText = `id: ${msg.id} data: ${msg.data}`\r\n//     }\r\n// }\r\n\r\n@observer\r\nclass SongPanel extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            songUrl: \"\",\r\n        }\r\n    }\r\n    playSong = async () => {\r\n\r\n        await fetch('/api/play', {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json;charset=utf-8'\r\n            },\r\n            body: JSON.stringify({url: this.state.songUrl})\r\n        })\r\n        this.setState({songUrl: ''})\r\n    }\r\n\r\n\r\n\r\n    render() {\r\n        const {rootStore} = this.props;\r\n        const {progress, duration} = this.state\r\n        return (\r\n            <div>\r\n                <div className={styles.songPanel}>\r\n                    <input className={styles.inputUrl} placeholder={\"вставьте URL\"} value={this.state.songUrl} onChange={(e)=> this.setState({songUrl: e.target.value})}/>\r\n                    <button className={styles.controls} onClick={this.playSong}>+</button>\r\n                </div>\r\n                {rootStore.songs.length > 0?\r\n                    <div className={styles.songContainer}>\r\n                        <Song song = {rootStore.songs[0]}/>\r\n                    </div>: null}\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default SongPanel;","import React, { Component } from \"react\";\r\nimport styles from \"./index.css\";\r\nimport {convertTime} from \"../../../utils\";\r\nimport {observer} from \"mobx-react\";\r\n\r\n@observer\r\nclass Queue extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n    }\r\n\r\n    render() {\r\n\r\n        return (\r\n            <div className={styles.queueContainer}>\r\n                <h3>Очередь</h3>\r\n                <ul className={styles.queue}>\r\n                    {this.props.rootStore.songs.length > 0? this.props.rootStore.songs.map(song => (\r\n                        <li key={song.id} className={styles.queueItem}>\r\n                            <p>{song.title}</p>\r\n                            <span>{convertTime(song.length)}</span>\r\n                        </li>\r\n                    )): <li>\r\n                        <div className={styles.empty}>Пусто</div>\r\n                    </li>}\r\n                </ul>\r\n            </div>\r\n        );\r\n    }\r\n}\r\nexport default Queue","import React, {Component} from 'react';\r\nimport styles from \"./index.css\";\r\n\r\nclass Addons extends Component {\r\n    render() {\r\n        return (\r\n            <div className={styles.addons}>\r\n                \r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default Addons;","import {inject, observer} from \"mobx-react\";\r\nimport React, {Component} from \"react\";\r\nimport SongPanel from \"../SongPanel/songPanel\";\r\nimport Queue from \"../Queue\";\r\nimport styles from \"./index.css\";\r\nimport Addons from \"../Addons\";\r\n\r\n@inject(\"rootStore\")\r\n@observer\r\nclass MusicConsole extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            queue: null,\r\n            ws: null\r\n        }\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.connect();\r\n        this.checkQueue();\r\n    }\r\n\r\n    connect = () => {\r\n        const ws = new WebSocket(`wss://dsbotweb.herokuapp.com`)\r\n        let that = this;\r\n        let connectInterval\r\n        ws.onopen = () => {\r\n            console.log(\"connected websocket\");\r\n\r\n            this.setState({ ws: ws });\r\n\r\n            that.timeout = 250; // reset timer to 250 on open of websocket connection\r\n            clearTimeout(connectInterval); // clear Interval on on open of websocket connection\r\n        };\r\n\r\n        ws.onclose = e => {\r\n            console.log(\r\n                `Socket is closed. Reconnect will be attempted in ${Math.min(\r\n                    10000 / 1000,\r\n                    (that.timeout + that.timeout) / 1000\r\n                )} second.`,\r\n                e.reason\r\n            );\r\n\r\n            that.timeout = that.timeout + that.timeout; //increment retry interval\r\n            connectInterval = setTimeout(this.check, Math.min(10000, that.timeout)); //call check function after timeout\r\n        };\r\n\r\n        ws.onmessage = evt => {\r\n            // listen to data sent from the websocket server\r\n            const message = JSON.parse(evt.data)\r\n            if(message.queue){\r\n                this.props.rootStore.checkQueue(message);\r\n            }\r\n        }\r\n\r\n        ws.onerror = err => {\r\n            console.error(\r\n                \"Socket encountered error: \",\r\n                err.message,\r\n                \"Closing socket\"\r\n            );\r\n\r\n            ws.close();\r\n        };\r\n    }\r\n\r\n    checkQueue = async () => {\r\n        const res = await fetch('/api/queue')\r\n        const data = await res.json()\r\n        this.props.rootStore.checkQueue(data);\r\n    }\r\n\r\n    render() {\r\n\r\n        return (\r\n            <div>\r\n                <SongPanel rootStore={this.props.rootStore}/>\r\n                <div className={styles.addonsContainer}>\r\n                    <Queue rootStore = {this.props.rootStore}/>\r\n                    <Addons/>\r\n                </div>\r\n\r\n            </div>\r\n        );\r\n    }\r\n}\r\nexport default MusicConsole","import React, {Component} from 'react';\r\nimport {observer} from \"mobx-react\";\r\nimport MusicConsole from \"../components/Music/MusicConsole\";\r\n\r\n@observer\r\nclass Music extends Component{\r\n    constructor(props) {\r\n        super(props);\r\n    }\r\n\r\n    // componentDidMount() {\r\n    //     const eventSource = new EventSource(\"http://localhost:4000/music\")\r\n    //     const dataElem = document.getElementById(\"data\")\r\n    //     eventSource.onmessage = (msg) => {\r\n    //         dataElem.innerText = `id: ${msg.id} data: ${msg.data}`\r\n    //     }\r\n    // }\r\n\r\n    render(){\r\n\r\n        return (\r\n            <div>\r\n                <MusicConsole/>\r\n            </div>\r\n\r\n        );\r\n    }\r\n}\r\n\r\nexport default Music;\r\n"],"sourceRoot":""}